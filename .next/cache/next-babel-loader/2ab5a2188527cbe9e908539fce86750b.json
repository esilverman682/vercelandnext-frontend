{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/esm/asyncToGenerator\";\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nimport { jsxs as _jsxs } from \"react/jsx-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-runtime\";\nimport { useRouter } from 'next/router';\nimport { loadStripe } from '@stripe/stripe-js';\nimport { API_URL, STRIPE_PK } from '../utils/urls';\nimport styles from '../styles/BuyButton.module.css';\nimport { useContext } from \"react\";\nimport AuthContext from \"../context/AuthContext\";\nvar stripePromise = loadStripe(STRIPE_PK);\nexport default function BuyButton(_ref) {\n  var product = _ref.product;\n\n  var _useContext = useContext(AuthContext),\n      user = _useContext.user,\n      getToken = _useContext.getToken;\n\n  var router = useRouter();\n\n  var handleBuy = /*#__PURE__*/function () {\n    var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(e) {\n      var stripe, token, res, session, result;\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              _context.next = 2;\n              return stripePromise;\n\n            case 2:\n              stripe = _context.sent;\n              _context.next = 5;\n              return getToken();\n\n            case 5:\n              token = _context.sent;\n              console.log(\"handleBuy token\", token);\n              e.preventDefault();\n              _context.next = 10;\n              return fetch(\"\".concat(API_URL, \"/orders/\"), {\n                method: 'POST',\n                body: JSON.stringify({\n                  product: product\n                }),\n                headers: {\n                  'Content-type': 'application/json',\n                  'Authorization': \"Bearer \".concat(token)\n                }\n              });\n\n            case 10:\n              res = _context.sent;\n              _context.next = 13;\n              return res.json();\n\n            case 13:\n              session = _context.sent;\n              console.log(\"session\", session);\n              _context.next = 17;\n              return stripe.redirectToCheckout({\n                sessionId: session.id\n              });\n\n            case 17:\n              result = _context.sent;\n\n            case 18:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    }));\n\n    return function handleBuy(_x) {\n      return _ref2.apply(this, arguments);\n    };\n  }();\n\n  var redirectToLogin = /*#__PURE__*/function () {\n    var _ref3 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2() {\n      return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              router.push('/login');\n\n            case 1:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, _callee2);\n    }));\n\n    return function redirectToLogin() {\n      return _ref3.apply(this, arguments);\n    };\n  }();\n\n  return /*#__PURE__*/_jsxs(_Fragment, {\n    children: [user && /*#__PURE__*/_jsx(\"button\", {\n      className: styles.buy,\n      onClick: handleBuy,\n      children: \"BUY\"\n    }), !user && /*#__PURE__*/_jsx(\"button\", {\n      className: styles.buy,\n      onClick: redirectToLogin,\n      children: \"Login to Buy\"\n    })]\n  });\n}","map":null,"metadata":{},"sourceType":"module"}